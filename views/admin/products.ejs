<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Products - GrocerGo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body class="bg-muted text-foreground font-sans">
    <div class="flex min-h-screen">
        <!-- Sidebar with active highlight -->
        <%- include('./partials/sidebar', { currentPath: '/admin/products' }) %>

        <main class="flex-1 p-6 md:p-8">
            <div class="max-w-6xl mx-auto space-y-8">

                <!-- Page header -->
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <h2 class="text-3xl font-bold mb-1">Manage Products</h2>
                        <p class="text-sm text-muted-foreground">
                            View, verify and maintain products listed on GrocerGo.
                        </p>
                    </div>
                    <a href="/admin/products/new"
                       class="inline-flex items-center px-5 py-2.5 rounded-lg bg-primary text-primary-foreground font-semibold text-sm hover:bg-green-700 shadow-md">
                        <i class="fas fa-plus mr-2 text-xs"></i>
                        Add new product
                    </a>
                </div>

                <!-- Products table card -->
                <section class="bg-card p-6 rounded-xl shadow-md border border-border overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Brand</th>
                                    <th>Price</th>
                                    <th>Stock</th>
                                    <th>Verified</th>
                                    <th class="text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% if (products && products.length) { %>
                                    <% products.forEach(product => { %>
                                        <tr>
                                            <td><%= product.name %></td>
                                            <td><%= product.brand && product.brand.name ? product.brand.name : '—' %></td>
                                            <td>₹<%= product.price.toFixed(2) %></td>
                                            <td><%= product.stock %></td>
                                            <td>
                                                <span class="font-semibold <%= product.verified ? 'text-green-600' : 'text-gray-500' %>">
                                                    <%= product.verified ? 'Yes' : 'No' %>
                                                </span>
                                            </td>
                                            <td class="admin-actions-cell">
                                                <!-- Edit -->
                                                <a href="/admin/products/<%= product._id %>/edit"
                                                   class="admin-action-btn admin-action-edit">
                                                    Edit
                                                </a>

                                                <!-- Verify / Unverify (Admin only) -->
                                                <% if (user && user.role === 'ADMIN') { %>
                                                    <form action="/admin/products/<%= product._id %>/verify"
                                                          method="POST" class="inline-block">
                                                        <button type="submit"
                                                            class="admin-action-btn <%= product.verified ? 'admin-action-unverify' : 'admin-action-verify' %>">
                                                            <%= product.verified ? 'Un-verify' : 'Verify' %>
                                                        </button>
                                                    </form>
                                                <% } %>

                                                <!-- Delete -->
                                                <form action="/admin/products/<%= product._id %>/delete"
                                                      method="POST"
                                                      class="inline-block"
                                                      onsubmit="return confirm('Are you sure you want to delete this product?');">
                                                    <button type="submit"
                                                        class="admin-action-btn admin-action-delete">
                                                        Delete
                                                    </button>
                                                </form>
                                            </td>
                                        </tr>
                                    <% }) %>
                                <% } else { %>
                                    <tr>
                                        <td colspan="6" class="text-center py-6 text-sm text-muted-foreground">
                                            No products found. Try adding a new product.
                                        </td>
                                    </tr>
                                <% } %>
                            </tbody>
                        </table>
                    </div>
                </section>

            </div>
        </main>
    </div>
</body>
</html>
